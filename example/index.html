<html>
	<head>
		<meta charset="utf-8">
		<title>demo</title>
	</head>
	<body>
		<script type="text/javascript" src="../dist/reo.js"></script>
		<script type="text/javascript">
			const app = reo();

			app.model({
				name: 'foo',
				state: { food: 'rice' },
				reducers: {
					bar( state, payload ) {
						state.food = payload;
					}
				},
				effects: {
					bar( { commit }, payload ) {
						setTimeout(function () {
							commit( 'bar', payload )
						}, 1000);
					}
				}
			})

			app.model( {
				name: 'counter',
				state: { count: 0 },
				reducers: {
					add( state, payload = 1 ) {
						state.count = state.count + payload;
					},
					minus( state, payload = 1 ) {
						state.count = state.count - payload;
					}
				},
				// TODO: move effects into actions
				effects: {
					addSync( { commit, dispatch }, num ) {
						dispatch( 'foo/bar', 'rice2' );
						commit( 'add', num );
					},
					minusSync( { commit }, num ) {
						commit( 'minus', num );
					},
					addAsync( { commit }, num ) {
						setTimeout(function () {
							commit( 'add', num );
						}, 4000);
					}
				},
			} );

			app.actions( {

			} );

			const Counter = app.view( {
				// models: [ 'counter' ],
				// components: {},
				props: {
					c: function( state ) {
						return state.counter.count;
					}
				},
				render: `
					{ c }
					<button on-click="{ this.dispatch( 'counter/addSync' ) }">+</button>
					<button on-click="{ this.dispatch( 'counter/minusSync' ) }">-</button>
					<button on-click="{ this.dispatch( 'counter/addAsync', 9 ) }">async add</button>
				`
			} );

			Counter.inject( document.body );

			app.start();
		</script>
	</body>
</html>
